<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.deataworld.reviewMapper">

	<!-- 리뷰 작성 -->
  	<insert id="reviewRegister" parameterType="ReviewDTO">
		insert into review (w_rate,w_comments,w_date,w_status,w_writer,id_rated,a_number)
		values (#{w_rate}, #{w_comments},now(),0,#{w_writer},#{id_rated},#{a_number})		
	</insert>
	
	<!--  -->
	<update id="updateStatus" parameterType="Map">
		UPDATE job_apply
		SET jar_status = 7 
		WHERE (a_number = #{a_number} and m_id = #{m_id});
	
	</update>
	
	<!-- 작성된 리뷰 내용 확인 -->
	<select id="wroteDetail" parameterType="java.lang.Integer" resultType="Map">
		select r.*, rc.*
		from review r
			left outer join review_comments rc
			on r.w_number = rc.w_number
		where r.a_number = #{a_number}
        or r.w_number = rc.w_number
	</select>
	
	<!-- 완료된 공고 목록보기 -->	
  	<select id="r_adsCompleted" parameterType="String" resultType="Map">
  		select s.s_name, a.*, ja.*, m.m_nick, ja.m_id as id_rated
		from job_ads a, shop_info s, job_apply ja, member m
		where a.m_id = s.m_id and a.m_id = #{m_id} 
		and a.a_status = 3
		and a.s_number = s.s_number
		and a.a_number = ja.a_number
		and ja.m_id = m.m_id
  	</select>
  	
  	<!-- 리뷰 작성한 공고 목록 -->
	<select id="r_wroteReviews" parameterType="String" resultType="Map">
		select ja.*, a.*, s.*, r.*, m.m_nick, date(r.w_date) as date
		from job_apply ja, job_ads a, shop_info s, review r, member m
		where ja.a_number = a.a_number 
		and a.s_number = s.s_number 
		and s.m_id = a.m_id 
		and r.a_number = a.a_number
		and a.m_id = r.w_writer and s.m_id = r.w_writer and r.w_writer = #{m_id} 
		and m.m_id = ja.m_id				
	</select>
	
	<!-- 리뷰 작성된 공고 목록-->
	<select id="r_writtenReviews" parameterType="String" resultType="Map">
		select ja.*, a.*, s.*, r.*, m.m_nick, date(r.w_date) as date
		from job_apply ja, job_ads a, shop_info s, review r, member m
		where ja.a_number = a.a_number 
		and a.s_number = s.s_number 
		and s.m_id = a.m_id 
		and r.a_number = a.a_number
		and a.m_id = r.id_rated and s.m_id = r.id_rated and r.id_rated = #{m_id}
		and m.m_id = r.w_writer
	</select>
	

</mapper>